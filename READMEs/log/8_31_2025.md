# TLDR

High level steps of what I think is needed...

1. Auth to GCP
1. Create a GCP Pub/Sub Topic
1. Build a simple Cloud Function (this is actually what this code repo is)
1. Test the simple Cloud Function locally
1. Enable `cloudfunctions.googleapis.com` on the project
1. Set up a Google Cloud Function to act as the subscriber to the topic
1. Publish to the Topic from the FastAPI

## How to auth to GCP

- gcloud auth login <!-- trigger auth flow from CLI to GCP -->
- gcloud config list <!-- Review gcloud CLI settings -->

## Create a GCP Pub/Sub Topic

- https://cloud.google.com/pubsub/docs/create-topic
- Using the `gcloud pubsub topics create TOPIC_ID`
- ie: `gcloud pubsub topics create kb-ingest-topic`
- Verify topic was created: `https://console.cloud.google.com/cloudpubsub/topic/list`

## Enable Cloud Functions & Eventarc in the GCP Project

- `gcloud services enable cloudfunctions.googleapis.com`
- `gcloud services enable eventarc.googleapis.com`

## Deploy the Cloud Function

```sh
gcloud functions deploy processPubSubMessage \
--runtime=nodejs22 \
--trigger-topic=kb-ingest-topic \
--region=us-east1 \
--memory=1GB \
--timeout=540s \
--source ./build \
--entry-point=processPubSubMessage \
--gen2
```